# 任务 4：Stage 2 KD - Fused logits 蒸馏
# 从 Stage 1 checkpoint 初始化，使用 teacher 的 fused logits 作为主要 KD 目标。
# 特征 KD 关闭，响应 KD 减弱，fused KD 作为主信号。

data:
  distance: 3
  rounds: 5
  noise_strength: 0.005
  snr: 10.0
  use_soft: true
  num_train: 200000
  num_val: 20000
  batch_size: 512
  seed: 42
  online: true

teacher:
  checkpoint: "checkpoints/mock_teacher_d3/best_model.pt"
  probe_heads: "checkpoints/mock_teacher_d3/probe_heads.pt"

model:
  size: "small"
  rnn_type: "gru"
  init_checkpoint: "checkpoints/stage1_kd_d3/best_model.pt"

distillation:
  alpha: 0.3          # 任务损失（真实标签 CE）
  beta: 0.1           # 响应 KD（减弱）
  gamma_cnn: 0.0      # 不使用 CNN 特征 KD
  gamma_rnn: 0.0      # 不使用 RNN 特征 KD
  gamma_fused: 0.6    # Fused logit KD（主信号）
  temperature: 2.0

training:
  epochs: 30
  learning_rate: 0.0005   # 从 Stage 1 微调用较低学习率
  weight_decay: 0.0001
  scheduler: "cosine"
  warmup_steps: 100
  grad_clip: 1.0
  device: "auto"

logging:
  log_interval: 50
  eval_interval: 1
  save_dir: "checkpoints/stage2_kd_d3"
